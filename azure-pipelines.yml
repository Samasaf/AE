trigger:
  branches:
    include:
      - main  # تأكدي أن الفرع صحيح

pool:
  name: 'Demo'  # تأكدي أن اسم الـ Self-Hosted Agent لديكِ صحيح

stages:
- stage: Build
  displayName: 'Setup Environment'
  jobs:
  - job: Build
    steps:
    - checkout: self  # جلب الكود من GitHub

    - script: |
        python --version
      displayName: 'Verify Python Installation'

    - script: |
        python -m venv venv
        call venv\Scripts\activate
        pip install --upgrade pip
        pip install -r requirements.txt
      displayName: 'Setup Python Environment & Install Dependencies'

- stage: Test
  displayName: 'Run Robot Framework Tests'
  dependsOn: Build
  jobs:
  - job: Test
    steps:
    - script: |
        call venv\Scripts\activate
        robot -d results AE/Tests
      displayName: 'Run Tests'

- stage: Deploy
  displayName: 'Save Test Results'
  dependsOn: Test
  condition: succeeded()
  jobs:
  - job: Deploy
    steps:
    - publish: $(System.DefaultWorkingDirectory)/results
      artifact: test-results
      displayName: 'Save Test Results'
